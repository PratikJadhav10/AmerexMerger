<!DOCTYPE html>
<html>

<head>
	<title>Search Form</title>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
	<link rel="stylesheet"
		href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/css/bootstrap-datepicker.min.css">
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
	<!--<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>-->
	<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
	<script
		src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/js/bootstrap-datepicker.min.js"></script>
	<style>
		body {
			font-family: Arial, sans-serif;
			margin: 20px;
		}

		h1 {
			color: #333;
		}



		label {
			display: block;
			margin-top: 10px;
		}

		.radio-group {
			display: flex;
			align-items: center;
		}

		.radio-group label {
			margin-right: 10px;
		}

		.form-row {
			display: flex;
			justify-content: space-between;
			align-items: center;
		}

		#centertext {
			text-align: center;
		}

		.form-row label {
			flex: 1;
			margin-right: 10px;
		}

		.form-row input[type="text"],
		.form-row input[type="date"] {
			flex: 2;
		}

		button {
			background-color: #4CAF50;
			color: white;
			padding: 10px 20px;
			border: none;
			cursor: pointer;
			margin-top: 10px;
		}

		textarea {
			width: 100%;
			padding: 10px;
			margin-top: 10px;
			border: 1px solid #ccc;
			border-radius: 4px;
		}
	</style>
</head>

<body>
	<div class="container text-center">
		<h2>XML Screen</h2>
	</div>

	<form>

		<div class="container">
			<form>
				<div class="radio">
					<label><input type="radio" name="optradio" value="traderef" onclick="enableDateField()">Search by
						Traderef & date</label>
				</div>
				<div class="radio">
					<label><input type="radio" name="optradio" value="gatewayid" onclick="disableDateField()">Search by
						Gateway ID</label>
				</div>
			</form>
		</div>
		<div class="container-fluid">
			<div class="row">
				<div class="col-sm-4" style="background-color:rgb(255, 255, 255);">
					<form>
						<div class="form-group">
							<label for="usr">Trade Ref or Gateway ID:</label>
							<input type="text" class="form-control" id="bridgeRequestId" disabled>
						</div>
					</form>
				</div>
				<div class="col-sm-4" style="background-color:rgb(255, 255, 255);">
					<form>
						<div class="form-group">
							<label for="dateInput">Date:</label>
							<input type="datetime-local" id="dateInput" name="dateInput" min="2023-05-15T00:00"
								max="2023-05-18T00:00" disabled>
						</div>
					</form>
				</div>
				<div class="col-sm-4" style="background-color:rgb(255, 255, 255);">
					<div class="form-group">
						<label for="dateInput">Source System:</label>
						<button class="btn btn-primary dropdown-toggle" type="button" data-toggle="dropdown">Select
							<span class="caret"></span></button>
						<ul class="dropdown-menu">
							<li><a href="#">Option a</a></li>
							<li><a href="#">Option b</a></li>
							<li><a href="#">Option c</a></li>
						</ul>
					</div>
				</div>
			</div>
		</div>
		<br>
		<div class="container">
			<div class="form-group">
				<label for="datetimepicker">Date and Time:</label>
				<div class="input-group date" id="datetimepicker" data-target-input="nearest">
					<input type="text" class="form-control datetimepicker-input" data-target="#datetimepicker" />
					<div class="input-group-append" data-target="#datetimepicker" data-toggle="datetimepicker">
						<div class="input-group-text"><i class="fa fa-calendar"></i></div>
					</div>
				</div>
			</div>
		</div>
		<!--<br>
		<label for="dateInput">Date:</label>
		<input type="date" id="dateInput" name="dateInput" disabled>
		<br>-->
		<div class="container text-center">
			<button type="button
					" id="displayBtn" class="btn btn-primary btn-sm btn-success" onclick="retrieveXML()">
				Retrieve
				XML
			</button>
		</div>
		<br>
		<div class="container">
			<form>
				<div class="form-group">
					<label for="comment"></label>
					<textarea class="form-control" rows="8" id="designationTextArea"></textarea>
				</div>
			</form>
		</div>
		<div class="container text-center">
			<button type="button" id="submitBtn" class="btn btn-primary btn-sm btn-success" onclick="postData()">
				Submit
			</button>
		</div>
		<div class="container text-center">
			(only enabled for failed data)
		</div>
		<br>
	</form>
	<script>

		function enableDateField() {
			document.getElementById('bridgeRequestId').disabled = false;
			document.getElementById('dateInput').disabled = false;
			var currentDate = new Date().toISOString().slice(0, 16);
			document.getElementById('dateInput').min = currentDate;
			document.getElementById('dateInput').max = currentDate;
			document.getElementById('dateInput').value = currentDate;
		}

		function disableDateField() {
			document.getElementById('dateInput').disabled = true;
			document.getElementById('bridgeRequestId').disabled = false;
		}

		function retrieveXML() {
			$(document).ready(function () {
				$("#displayBtn").click(function () {
					var bridgeRequestId = $("#bridgeRequestId").val();
					$.get("/data/new/" + bridgeRequestId, function (data) {
						$("#designationTextArea").val(data);
					});
				});
			});
			// Retrieve XML logic goes here
		}

		$(document).ready(function () {
			$('#datetimepicker').datetimepicker({
				format: 'YYYY-MM-DD HH:mm:ss'
			});
		})


		function updateXML() {
			// Retrieve the updated data from the textarea
			var bridgeRequestId = $("#bridgeRequestId").val();
			var updatedData = $("#designationTextArea").val();
			console.log("hello there 1");

			// Prepare the data to be sent in the request body
			var requestBody = {
				bridgeRequestId: bridgeRequestId, // Replace with the actual record count
				updatedData: updatedData
			};

			// Get the CSRF token from the server
			$.get("/api/amerex/csrf-token", function (csrfToken) {
				// Include the CSRF token in the request headers
				$.ajax({
					url: "/api/amerex/updateData",
					type: "POST",
					contentType: "application/json",
					data: JSON.stringify(requestBody),
					headers: {
						"X-CSRF-TOKEN": csrfToken // Include the CSRF token in the request headers
					},
					success: function (response) {
						// Handle the response
						console.log(response);
						console.log("hello there");// Perform any additional actions after successful update
					},
					error: function (error) {
						// Handle any errors that occurred during the request
						console.error(error);
					}
				});
			});
			console.log("hello there 2");
		}



		function updateData() {
			// Retrieve the updated data from the textarea
			var updatedData = document.getElementById("textarea").value;

			// Prepare the data to be sent in the request body
			var requestBody = {
				recordCount: recordCount, // Replace with the actual record count
				updatedData: updatedData
			};

			// Send the AJAX request
			fetch("/api/amerex/updateData", {
				method: "POST",
				headers: {
					"Content-Type": "application/json"
				},
				body: JSON.stringify(requestBody)
			})
				.then(function (response) {
					// Handle the response
					if (response.ok) {
						return response.text();
					} else {
						throw new Error("Error updating data: " + response.status);
					}
				})
				.then(function (responseText) {
					// Display a success message or perform any other actions
					console.log(responseText);
				})
				.catch(function (error) {
					// Handle any errors that occurred during the request
					console.error(error);
				});
		}

		function postData() {
			// Retrieve the updated data from the textarea
			var bridgeRequestId = $("#bridgeRequestId").val();
			var updatedData = $("#designationTextArea").val();
			//var updatedData = document.getElementById("designationTextArea").value;
			//var bridgeRequestId = document.getElementById("bridgeRequestId").value;

			// Fetch the CSRF token
			fetch("/api/amerex/csrf-token")
				.then(function (response) {
					if (response.ok) {
						return response.text();
					} else {
						throw new Error("Error retrieving CSRF token: " + response.status);
					}
				})
				.then(function (csrfToken) {
					// Prepare the data to be sent in the request body
					var requestBody = {
						bridgeRequestId: parseInt(bridgeRequestId), // Convert to a number
						updatedData: updatedData
					};

					// Send the AJAX request with the CSRF token
					fetch(`/data/new/update/messageload?bridgeRequestId=${requestBody.bridgeRequestId}`, {
						method: "PUT",
						headers: {
							"Content-Type": "application/json",
							"X-CSRF-Token": csrfToken
						},
						body: JSON.stringify(requestBody.updatedData)
					})
						.then(function (response) {
							// Handle the response
							if (response.ok) {
								return response.text();
							} else {
								throw new Error("Error updating data: " + response.status);
							}
						})
						.then(function (responseText) {
							console.log("Successful");
							// Display a success message or perform any other actions
							console.log(responseText);
						})
						.catch(function (error) {
							// Handle any errors that occurred during the request
							console.log("Failed");
							console.error(error);
						});
				})
				.catch(function (error) {
					// Handle any errors that occurred during the CSRF token retrieval
					console.error(error);
				});
		}



	</script>
</body>

</html>